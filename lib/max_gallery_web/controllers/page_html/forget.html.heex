<!DOCTYPE html>
<html lang="en">
  <body>
    <div class="flex justify-center items-center h-[70vh]">
      <div class="bg-white p-8 rounded-xl shadow-lg m-auto w-[40%]">
        <h1 class="text-2xl font-bold mb-6 text-center text-gray-800">
          Forgot my Password.
        </h1>

        <.form for={%{}} method="post" action="/request/email-forget">
          <label class="block mb-4">
            <span class="text-gray-700">Your e-mail</span>
            <input
              name="email"
              type="email"
              placeholder="john@smith.com"
              class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-md border-1 focus:border-blue-600"
              required
            />
          </label>

          <button
            type="submit"
            id="resend-button"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            disabled={@send == :wait}
          >
            Send me the recuperation link.
          </button>
        </.form>

        <div id="resend-container" class="mt-2">
          <%= if @remain do %>
            <p class="text-sm text-yellow-600 text-center">
              You can resend the email in (seconds):
            </p>
            <p class="text-sm text-yellow-800 text-center font-bold" id="countdown">
              {@remain}
            </p>
          <% else %>
            <%= cond do %>
              <% @send -> %>
                <p class="text-sm text-green-600 text-center font-bold">
                  {@txt}
                </p>
              <% @txt -> %>
                <p class="text-md text-red-800 text-center">
                  {@txt}
                </p>
              <% true -> %>
                <p class="text-sm text-green-600 text-center font-bold">
                  You can send the email now
                </p>
            <% end %>
          <% end %>
        </div>

        <script>
          document.addEventListener("DOMContentLoaded", () => {
            const countdownEl = document.getElementById("countdown");
            const resendButton = document.getElementById("resend-button");
            const resendContainer = document.getElementById("resend-container");

            if (countdownEl && countdownEl.textContent.trim()) {
              let time = parseInt(countdownEl.textContent.trim());
              
              if (time > 0) {
                const interval = setInterval(() => {
                  time--;
                  countdownEl.textContent = time;

                  if (time <= 0) {
                    clearInterval(interval);
                    
                    // Update the container to show success message
                    resendContainer.innerHTML = '<p class="text-sm text-green-600 text-center font-bold">You can resend the email now</p>';
                    
                    // Enable the resend button
                    if (resendButton) {
                      resendButton.disabled = false;
                      resendButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                  }
                }, 1000);
              }
            }
          });
        </script>
      </div>
    </div>
  </body>
</html>
