<!DOCTYPE html>
<html lang="en">
  <body>
    <div class="flex justify-center items-center h-[70vh]">
      <div class="flex flex-col items-center md:h-[60%] md:w-[60%]  rounded-lg shadow-xl m-auto border p-8">
        <h1 class="text-2xl font-bold">Check your E-mail Box and Spam section</h1>
        <p class="text-lg text-gray-600 mb-8">
          Confirm the code sended in your e-mail, and insert here.
        </p>

        <.form
          for={%{}}
          method="post"
          action="/email-verify"
          class="flex flex-col h-[50%] w-full items-center justify-end mb-2"
        >
          <p class="text-sm text-gray-400">Email sended to: {@email}</p>
          <input
            type="text"
            inputmode="numeric"
            maxlength="6"
            minlength="6"
            name="place_code"
            placeholder="123 456"
            class="px-6 py-2 w-[50%] border border-gray-600 border-1 focus:border-blue-600 rounded-lg text-center mb-1"
            required
          />

          <button type="submit" class="px-6 py-2 w-[50%] text-white bg-blue-600 rounded-lg">
            Confirm
          </button>
          <p class="text-sm text-red-600 text-center">{@err_code}</p>
        </.form>


        <.form
          for={%{}}
          method="get"
          action="/email-verify"
          class="flex flex-col items-center justify-end w-full"
        >
          <button 
            type="submit" 
            id="resend-button"
            class="px-6 py-2 w-[50%] text-blue-600 bg-transparent rounded-lg transition-colors hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed"
            disabled={@remain}
          >
            Resend Code
          </button>
        </.form>

        <div id="resend-container" class="mt-2">
          <%= if @remain do %>
            <p class="text-sm text-yellow-600 text-center">
              You can resend the email in (seconds):
            </p>
            <p class="text-sm text-yellow-800 text-center font-bold" id="countdown">
              {@remain}
            </p>
          <% else %>
            <p class="text-sm text-green-600 text-center font-bold">
              You can resend the email now
            </p>
          <% end %>
        </div>

        <script>
          document.addEventListener("DOMContentLoaded", () => {
            const countdownEl = document.getElementById("countdown");
            const resendButton = document.getElementById("resend-button");
            const resendContainer = document.getElementById("resend-container");

            if (countdownEl && countdownEl.textContent.trim()) {
              let time = parseInt(countdownEl.textContent.trim());
              
              if (time > 0) {
                const interval = setInterval(() => {
                  time--;
                  countdownEl.textContent = time;

                  if (time <= 0) {
                    clearInterval(interval);
                    
                    // Update the container to show success message
                    resendContainer.innerHTML = '<p class="text-sm text-green-600 text-center font-bold">You can resend the email now</p>';
                    
                    // Enable the resend button
                    if (resendButton) {
                      resendButton.disabled = false;
                      resendButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                  }
                }, 1000);
              }
            }
          });
        </script>

      </div>
    </div>
  </body>
</html>
